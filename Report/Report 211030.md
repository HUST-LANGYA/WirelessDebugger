# Report 211027

Lenor

## 基本介绍

无线数据传输器分为两个部分，上位机程序与单片机程序。

![image-20211030221411399](Report 211030.assets/image-20211030221411399.png)

大概就是如图所示的这么个情况。

其中单片机程序过于简单，就不放完整源码了。

上位机主要负责读取单片机发送来的数据并画图。

单片机与电脑通过无线串口模块进行通信（例如基于nRF24L01的无线串口）。

## 单片机程序

只需通过串口按照以下格式发送数据即可：

```C
'T'+HAL_GetTick()+'S'+'D'+Data+'E'
```

其中Data是任意数字。例如，样例程序如下(已经重定向printf至UART1)

```C
uint32_t time = HAL_GetTick();
printf("T%luS_D%dE\r\n", time, (int)(100*sin((double)time/500)));
```

## 上位机程序

现在做了一个演示的版本，目录：

> Code\SerialIlluDemo\ComTry.py

使用前需要修改一些内容：

Line 189: port改为无线串口模块对应的端口号。

## 演示效果

见上次的报告

## 新发现

### 搞了一些数据

#### 无线串口模块的数据

传输延迟：约10ms

传输速率：2Mbps

多个数据包之间的延迟$_{min}$：10ms

通信距离：10m以上

总结：对于无线传输而言，距离和速度是够的，但是延迟有点高了

#### Wi-Fi模块的理论数据

传输延迟：3ms以内（仅Wi-Fi，非AT指令）

传输速率：10Mbps以上

多个数据包之间的延迟：没查到

通信距离：5m以上

总结：延迟可以做得更低，而且可以直接做到单独的芯片上（ESP32）

### 关于无线J-Link

#### 两种方案及对应数据

如果要代替J-Link（SWD）有两种方式，一种是把上位机到J-Link的USB部分替换成无线模块。另一种是把J-Link的SWD两根线（SWDIO、SWCLK）替换成无线模块，以下讨论两种方案：

|                | 方案一(USB)                | 方案二(SWD)                           |
| -------------- | -------------------------- | ------------------------------------- |
| 传输方式       | USB两根线查分传输信号      | 类似IIC的传输模式                     |
| 传输速率       | 1.2Mbps起步，高可以特别高  | 4Mbps封顶，低可以特别低               |
| 容错方式       | 方法花的很                 | 偶校验                                |
| 第三方容错方式 | 基本没有，或者需要驱动配合 | 截获ack信号，依靠J-Link内部的容错机制 |

